<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0ea5e9" />
  <title>NWS Forecast (v2)</title>
  <!-- Leaflet (map) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
  <style>
    :root {
      --bg: #0b1220;              /* dark mode default */
      --card: #0f172a;
      --muted: #94a3b8;
      --text: #e2e8f0;
      --accent: #38bdf8;          /* sky-400 */
      --accent-strong: #0ea5e9;    /* sky-500 */
      --ok: #22c55e;
      --warn: #f59e0b;
      --bad: #ef4444;
      --ring: rgba(56,189,248,.45);
      --shadow: 0 10px 25px rgba(2,6,23,.35);
    }
    @media (prefers-color-scheme: light) {
      :root {
        --bg: #f8fafc;
        --card: #ffffff;
        --muted: #475569;
        --text: #0f172a;
        --accent: #0284c7;
        --accent-strong: #0369a1;
        --ring: rgba(2,132,199,.2);
        --shadow: 0 8px 18px rgba(2,8,23,.08);
      }
    }

    html, body { height: 100%; }
    body {
      margin: 0;
      background: linear-gradient(180deg, var(--bg), #0b1328 50%, var(--bg));
      color: var(--text);
      font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Inter, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    .container { max-width: 1100px; margin: 0 auto; padding: 16px; }

    header {
      position: sticky; top: 0; z-index: 40;
      backdrop-filter: blur(10px);
      background: color-mix(in oklab, var(--bg) 80%, transparent);
      border-bottom: 1px solid color-mix(in oklab, var(--muted) 25%, transparent);
    }
    .nav {
      display: flex; align-items: center; gap: 12px; padding: 10px 16px; max-width: 1100px; margin: 0 auto;
    }
    .title { font-weight: 800; letter-spacing: .2px; }
    .pill {
      display: inline-flex; gap: 8px; align-items: center;
      background: var(--card); color: var(--text);
      padding: 8px 12px; border-radius: 999px; border: 1px solid color-mix(in oklab, var(--muted) 25%, transparent);
      box-shadow: var(--shadow);
    }
    .btn {
      cursor: pointer; user-select: none;
      border: 0; padding: 8px 12px; border-radius: 10px;
      background: var(--accent); color: white; font-weight: 700;
      box-shadow: var(--shadow);
    }
    .btn:active { transform: translateY(1px); }

    .grid {
      display: grid; grid-template-columns: 1fr; gap: 16px; margin-top: 16px;
    }
    @media (min-width: 900px) {
      .grid { grid-template-columns: 1.15fr .85fr; }
    }
    .col { display: flex; flex-direction: column; gap: 16px; }

    .card {
      background: var(--card); border-radius: 18px; padding: 14px; box-shadow: var(--shadow);
      border: 1px solid color-mix(in oklab, var(--muted) 20%, transparent);
    }

    #radar { height: 380px; border-radius: 14px; overflow: hidden; }

    .row { display: flex; flex-wrap: wrap; gap: 12px; align-items: center; }
    .row.center { justify-content: center; }

    .kpis { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
    @media (min-width: 560px) { .kpis { grid-template-columns: repeat(4, 1fr); } }
    .kpi { background: color-mix(in oklab, var(--card) 96%, black); border: 1px dashed color-mix(in oklab, var(--muted) 25%, transparent); padding: 12px; border-radius: 12px; text-align: center; }
    .kpi .label { color: var(--muted); font-size: 12px; }
    .kpi .value { font-size: 22px; font-weight: 800; }

    .list { display: grid; grid-template-columns: 1fr; gap: 12px; }

    .hourlyScroller {
      display: grid; grid-auto-flow: column; grid-auto-columns: 66%; gap: 10px; overflow-x: auto; padding-bottom: 8px; scroll-snap-type: x mandatory;
    }
    @media (min-width: 560px) { .hourlyScroller { grid-auto-columns: 30%; } }
    @media (min-width: 900px) { .hourlyScroller { grid-auto-columns: 22%; } }

    .hourCard, .dayCard { scroll-snap-align: start; background: color-mix(in oklab, var(--card) 96%, black); border: 1px solid color-mix(in oklab, var(--muted) 25%, transparent); border-radius: 14px; padding: 12px; }
    .hourCard .top, .dayCard .top { display: flex; justify-content: space-between; gap: 10px; align-items: center; }
    .muted { color: var(--muted); font-size: 12px; }
    .temp { font-size: 24px; font-weight: 800; }

    .footnote { color: var(--muted); font-size: 12px; margin-top: 8px; }
    .lastUpdated { font-size: 12px; color: var(--muted); }

    .statusDot { width: 8px; height: 8px; border-radius: 999px; display: inline-block; background: var(--accent-strong); box-shadow: 0 0 0 4px var(--ring); }

    .loading { opacity: .7; }

    a, a:visited { color: var(--accent); text-decoration: none; }

    .attribution { font-size: 11px; color: var(--muted); display: flex; flex-wrap: wrap; gap: 6px; align-items: center; }
    .attribution span { white-space: nowrap; }

    .radarControls .label { font-size: 12px; color: var(--muted);}
    .range { width: 160px; }
  </style>
</head>
<body>
  <header>
    <nav class="nav">
      <div class="pill" title="Live">
        <span class="statusDot"></span>
        <span id="location">Locating…</span>
      </div>
      <div style="flex:1"></div>
      <strong class="title">NWS Forecast</strong>
      <div style="flex:1"></div>
      <button id="refreshBtn" class="btn" aria-label="Refresh forecast">Refresh</button>
    </nav>
  </header>

  <main class="container">
    <section class="grid">
      <div class="col">
        <div class="card">
        <h2 style="margin:6px 4px 10px">Radar</h2>
        <div id="radar" aria-label="Radar map"></div>
        <div id="radarControls" class="row radarControls" style="margin-top:10px; gap:10px">
          <div class="row" style="gap:8px">
            <span class="label">Layer</span>
            <select id="layerSelect" class="btn sm" style="padding:6px 10px">
              <option value="radar">Radar</option>
              <option value="satellite">Satellite</option>
              <option value="clouds">Clouds</option>
              <option value="temp">Temperature</option>
            </select>
          </div>
          <div class="row" style="gap:8px">
            <span class="label">Mode</span>
            <button data-mode="auto" class="btn sm" id="modeAuto">Auto</button>
            <button data-mode="animated" class="btn sm" id="modeAnim">Animated</button>
            <button data-mode="static" class="btn sm" id="modeStatic">Static</button>
            <button data-mode="off" class="btn sm" id="modeOff">Off</button>
          </div>
          <div style="flex:1"></div>
          <div class="row" style="gap:10px">
            <label class="label" for="frameSlider">Frame</label>
            <input id="frameSlider" class="range" type="range" min="0" max="0" value="0" aria-label="Radar time slider" />
            <span id="frameTime" class="muted">—</span>
          </div>
        </div>
        <div class="row" style="gap:14px; margin-top:8px">
          <div class="row" style="gap:8px">
            <span class="label">Max frames</span>
            <input id="maxFrames" class="range" type="range" min="6" max="60" value="24" />
            <span id="maxFramesLbl" class="muted">24</span>
          </div>
          <div class="row" style="gap:8px">
            <span class="label">Speed</span>
            <input id="speedSlider" class="range" type="range" min="120" max="800" step="20" value="450" />
            <span id="speedLbl" class="muted">450 ms</span>
          </div>
          <div class="row" style="gap:8px">
            <span class="label">Opacity</span>
            <input id="opacitySlider" class="range" type="range" min="20" max="100" value="60" />
            <span id="opacityLbl" class="muted">0.60</span>
          </div>
          <div class="row" style="gap:8px">
            <span class="label">Resolution</span>
            <button id="resStd" class="btn sm">Std</button>
            <button id="resHd" class="btn sm">HD</button>
          </div>
          <button id="playBtn" class="btn" aria-label="Play/Pause radar animation">Play</button>
        </div>
        <div class="footnote attribution" style="margin-top:8px">
          <span id="layerAttribution">Animated tiles: RainViewer • Static: NEXRAD (Iowa State Mesonet)</span>
          <span>•</span>
          <span>Map © OpenStreetMap</span>
          <span>•</span>
          <span id="radarDiag" class="muted"></span>
        </div>
      </div>
      <div class="col">
        <div class="card">
          <h2 style="margin:6px 4px 10px">Right now</h2>
        <div class="kpis">
          <div class="kpi"><div class="label">Current Temp</div><div id="nowTemp" class="value">—</div></div>
          <div class="kpi"><div class="label">Heat Index</div><div id="heatIndex" class="value">—</div></div>
          <div class="kpi"><div class="label">Chance of Rain (6h)</div><div id="pop6" class="value">—</div></div>
          <div class="kpi"><div class="label">Wind (now)</div><div id="windNow" class="value">—</div></div>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
          <div class="lastUpdated" id="lastUpdated">Loading…</div>
          <div class="footnote">Data: <a href="https://api.weather.gov/" target="_blank" rel="noreferrer noopener">NWS</a></div>
        </div>
        </div>
        <div class="card">
          <h2 style="margin:6px 4px 10px">Details</h2>
          <div class="kpis">
            <div class="kpi"><div class="label">Dew Point</div><div id="dewPoint" class="value">-</div></div>
            <div class="kpi"><div class="label">Humidity</div><div id="humidityNow" class="value">-</div></div>
            <div class="kpi"><div class="label">Rain (1h)</div><div id="pop1" class="value">-</div></div>
            <div class="kpi"><div class="label">Wind Gust</div><div id="gustNow" class="value">-</div></div>
            <div class="kpi"><div class="label">Sunrise</div><div id="sunrise" class="value">-</div></div>
            <div class="kpi"><div class="label">Sunset</div><div id="sunset" class="value">-</div></div>
          </div>
          <div class="footnote">Sun times: sunrise-sunset.org</div>
        </div>
      </div>
    </section>

    <section class="card">
      <h2 style="margin:6px 4px 12px">Lake levels</h2>
      <div id="lakes" class="list"></div>
      <div class="footnote attribution" style="margin-top:8px">
        <span>Sources: USGS NWIS, NOAA NWPS, Cube Carolinas</span>
      </div>
    </section>

    <section class="card">
      <h2 style="margin:6px 4px 12px">Hourly (next 12 hours)</h2>
      <div id="hourly" class="hourlyScroller loading"></div>
    </section>

    <section class="card">
      <h2 style="margin:6px 4px 12px">Daily (next 7 days)</h2>
      <div id="daily" class="list loading"></div>
    </section>

    

    <p class="footnote">
      Tip: Add this page to your phone’s home screen for quick access. Values refresh when you tap <strong>Refresh</strong>.
    </p>
  </main>

  <script src="main.js"></script>
</body>
</html>
